# vim: set filetype=make syntax=sh ts=8 sw=8 sts=0 noexpandtab :
#
# Additional repos for nrgaway
#
# Contains overrides specific to each branch as well as providing proper
# access to those with no ssh access to my repos

# NOTES:
# In a fresh qubes-builder vm, need these files to accept nrgaway repos
# - override.conf - repo defs + nrgaway-keyring
# - .setup.data.nrgaway -> over-write existing .setup.data (to verify my keys)
# - nrgaway-qubes-signing-key.asc
#
# Additional Makefile configuration scripts are located within my personal
# repo and kept out of builder repo to simplify updating.
#     git@github.com:nrgaway/qubes-tools.git
#     https://github.com/nrgaway/qubes-tools.git
# 
# Still need to run 'make import-keys' though; maybe add into setup
#
#
# for r2/r3 template branches
#
# Missing:
#   qubes-builder-windows
#   qubes-app-linux-input-proxy
#   qubes-app-linux-input-yubikey
#   qubes-app-linux-dom0-updates
#   qubesos.github.io
#   qubes-doc

[==- 'NOTES' ===================================================================
# Track upstream 
# git branch -u marmarek/master r3-templates
#
# Debian Package Hardening
# https://wiki.debian.org/Hardening

[==- './repo Configuration Settings' ===========================================
#GITHUB_PREFIX = $(word $(SSH_ACCESS)+1, http://github.com/nrgaway/qubes- git@github.com:nrgaway/qubes-)
GITHUB_PREFIX = git@github.com:nrgaway/qubes-
REPO_IGNORE = Whonix genmkfile
REPO_TRACK :=


[==- 'Git Branch Checkouts' ====================================================
[==- Override defaults (set in .setup.data to allow switching)
[===============================================================================
#GIT_PREFIX := nrgaway/qubes-
#GIT_BASEURL := git@github.com:
RELEASE_INDEX = $(shell echo "$(RELEASE)-1" | bc)


[==- 'qubes-tools' =============================================================
[==- Repo and directory location for additional includes
[===============================================================================
#COMPONENTS += tools
#TEMPLATE += tools
#GIT_URL_qubes_tools = $(GITHUB_PREFIX)tools.git
#BRANCH_qubes_tools = $(word $(RELEASE_INDEX), master master master)
REPO_TRACK += tools:master:origin:master
OVERRIDE_TOOLS_DIR = ../qubes-tools
OVERRIDE_CONF_DIR = $(OVERRIDE_TOOLS_DIR)/builder


[==- 'TEMP' ====================================================================
# TEMPLATE_FLAVOR_SALT = wheezy jessie fc


[==- 'Qubes COMPONENT Overrides' ===============================================
[==- All qubes-builder overrides
[===============================================================================
DEBUG = 1
VERBOSE = 2
NO_SIGN = 1
BUILDER_TURBO_MODE = 1
SIGN_KEY = 5A4C6DAD

#DIST_DOM0 := fc21
#NO_CHECK = genmkfile
#SNAPSHOT := 1
#SYSTEMD_NSPAWN_ENABLE := 0
#INCREMENT_DEVEL_VERSIONS=1

# DEBIAN_MIRRORS override
DEBIAN_MIRRORS= http://ftp.ca.debian.org/debian http://ftp.us.debian.org/debian http://http.debian.net/debian

-include $(OVERRIDE_CONF_DIR)/components.conf


[==- 'Qubes Web Documentation' =================================================
[==- All qubes-builder overrides
[===============================================================================
-include $(OVERRIDE_CONF_DIR)/docs.conf


[==- 'Salt Management Modules' =================================================
[==- Additional mgmt-salt modules
[===============================================================================
#MGMT_COMPONENTS := 
MGMT_SALT_ONLY = 0
MGMT_SALT_DEVELOPER_MODE = 1
MGMT_SALT_COMPONENTS_USER := mgmt-salt-user-nrgaway
-include $(OVERRIDE_CONF_DIR)/salt.conf


[==- 'Repo Git Management Tool' ================================================
[==- Provides various additional tools for git and repo management
[===============================================================================
-include $(OVERRIDE_CONF_DIR)/repo.conf


[==- 'Personal Alias Preferences' ==============================================
-include $(OVERRIDE_CONF_DIR)/aliases.conf


[==- 'Personal Alias Preferences' ==============================================
-include $(OVERRIDE_CONF_DIR)/keys.conf


# Returns variable value
# Example usage: GET_VAR=DISTS_VM make get-var
.PHONY: get-vars
get-vars::
	@$(eval vars = $(subst :, ,$(GET_VARS)))
	@for var in $(vars); do \
	    echo $${!var}; \
	done

about::
	@echo "override.conf"

.PHONY: import-keys import-key-nrgaway verify-trust verify-trust-marek

