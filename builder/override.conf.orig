# vim: set filetype=make syntax=sh ts=8 sw=8 sts=0 noexpandtab :
#
# Additional repos for nrgaway
#
# Contains overrides specific to each branch as well as providing proper
# access to those with no ssh access to my repos

# NOTES:
# In a fresh qubes-builder vm, need these files to accept nrgaway repos
# - override.conf - repo defs + nrgaway-keyring
# - .setup.data.nrgaway -> over-write existing .setup.data (to verify my keys)
# - nrgaway-qubes-signing-key.asc
# 
# Still need to run 'make import-keys' though; maybe add into setup
#
#
# for r2/r3 template branches
#
# Missing:
#   qubes-builder-windows
#   qubes-app-linux-input-proxy
#   qubes-app-linux-input-yubikey
#   qubes-app-linux-dom0-updates
#   qubesos.github.io
#   qubes-doc


[==- 'TEMP' ===================================================================
# TEMPLATE_FLAVOR_SALT = wheezy jessie fc

[==- 'NOTES' ==================================================================
# Track upstream 
# git branch -u marmarek/master r3-templates
#
# Debian Package Hardening
# https://wiki.debian.org/Hardening

MGMT_SALT_ONLY = 1
MGMT_SALT_DEVELOPER_MODE = 1
MGMT_SALT_USER_FORMULAS := mgmt-salt-user-nrgaway

DEBUG = 1
VERBOSE = 2
NO_SIGN = 1
BUILDER_TURBO_MODE = 1

SIGN_KEY = 5A4C6DAD

#DIST_DOM0 := fc21
#NO_CHECK = genmkfile
#SNAPSHOT := 1
#SYSTEMD_NSPAWN_ENABLE := 0
#INCREMENT_DEVEL_VERSIONS=1

# DEBIAN_MIRRORS override
DEBIAN_MIRRORS= http://ftp.ca.debian.org/debian http://ftp.us.debian.org/debian http://http.debian.net/debian

[==- './repo Configuration Settings' ===========================================
#GITHUB_PREFIX = $(word $(SSH_ACCESS)+1, http://github.com/nrgaway/qubes- git@github.com:nrgaway/qubes-)
GITHUB_PREFIX = git@github.com:nrgaway/qubes-
REPO_IGNORE = Whonix genmkfile
REPO_TRACK :=


[==- 'Git Branch Checkouts' ====================================================
[==- Override defaults (set in .setup.data to allow switching)
[===============================================================================
#GIT_PREFIX := nrgaway/qubes-
#GIT_BASEURL := git@github.com:
RELEASE_INDEX = $(shell echo "$(RELEASE)-1" | bc)


[==- 'Personal Alias Preferences' ==============================================
# jessie+gnome+flash
#TEMPLATE_LABEL := $(patsubst 	jessie+gnome+flash:debian-8-x64-gnome, \
#				jessie+gnome+flash:debian-jessie, $(TEMPLATE_LABEL))

# wheezy+whonix-gateway
#TEMPLATE_LABEL := $(patsubst 	wheezy+whonix-gateway:whonix-gateway-experimental, \
#				wheezy+whonix-gateway:whonix-gateway, $(TEMPLATE_LABEL))
# wheezy+whonix-workstation
#TEMPLATE_LABEL := $(patsubst 	wheezy+whonix-workstation:whonix-workstation-experimental, \
#				wheezy+whonix-workstation:whonix-workstation, $(TEMPLATE_LABEL))

# trusty+desktop+flash
#TEMPLATE_LABEL := $(patsubst 	trusty+desktop+flash:qubuntu-trusty-x64-desktop, \
#				trusty+desktop+flash:qubuntu-trusty-desktop, $(TEMPLATE_LABEL))
# utopic+desktop+flash
#TEMPLATE_LABEL := $(patsubst 	utopic+desktop+flash:qubuntu-utopic-x64-desktop, \
#				utopic+desktop+flash:qubuntu-utopic-desktop, $(TEMPLATE_LABEL))
# vivid+desktop+flash
#TEMPLATE_LABEL := $(patsubst 	vivid+desktop+flash:qubuntu-vivid-x64-desktop, \
#				vivid+desktop+flash:qubuntu-vivid-desktop, $(TEMPLATE_LABEL))


# git@github.com:nrgaway/qubes-tools.git
# https://github.com/nrgaway/qubes-tools.git
#
# Think I want to have the config files somewhere else and either have 
# setup inject them (since you can only have one file when building 
# via DisposibleVM
#
# Also need a way to select from 2, 3, and 3.1
#
# Also want to move any specific nrgaway tools out of builder so it's easier
# to update.
#
# XXX: So need to decide best approach
#        - Use setup to create one file
#        - Use overide with includes

[==- 'Additional Salt Management Components' ===================================
#MGMT_COMPONENTS = \
#	mgmt-salt \
#	mgmt-salt-base \
#	mgmt-salt-base-topd \
#	mgmt-salt-base-config \
#	mgmt-salt-base-overrides \
#	mgmt-salt-dom0-qvm \
#	mgmt-salt-dom0-virtual-machines \
#	mgmt-salt-dom0-update


[===============================================================================
[==- 'qubesos.github.io' =======================================================
[===============================================================================
#GIT_URL_qubesos.github.io = git@github.com:nrgaway/qubesos.github.io.git
#COMPONENTS += qubesos.github.io
#TEMPLATE += qubesos.github.io

#[==- 'python-sh' ===============================================================
#[==- defaults: [R2:master, R3:master, R3.1:master]
#[===============================================================================
#WHONIX_COMPONENTS += python-sh
#GIT_URL_python_sh = git@github.com:nrgaway/python-sh.git
#BRANCH_python_sh = $(word $(RELEASE_INDEX), master master master)
#REPO_TRACK += python-sh:master:origin:master

#[==- 'template-salt' ===========================================================
#[==- Development salt states, modules, etc
#[===============================================================================
#COMPONENTS += template-salt
#TEMPLATE += template-salt
#GIT_URL_template_salt = $(GITHUB_PREFIX)template-salt.git
#BRANCH_template_salt = $(word $(RELEASE_INDEX), manage manage master)
#REPO_TRACK += template-salt:manage:origin:manage


#[==- 'tools' ===================================================================
#[==- Personal development tools, research, notes, etc
#[===============================================================================
#COMPONENTS += tools
#TEMPLATE += tools
#GIT_URL_qubes_tools = $(GITHUB_PREFIX)tools.git
#BRANCH_qubes_tools = $(word $(RELEASE_INDEX), master master master)
REPO_TRACK += tools:master:origin:master


#[==- 'qubes-whonix' ============================================================
#[==- defaults: [R2:master, R3:master, R3.1:master]
#[===============================================================================
#GIT_URL_qubes_whonix = $(GITHUB_PREFIX)whonix.git
#BRANCH_qubes_whonix = $(word $(RELEASE_INDEX), master master master)
#REPO_TRACK += qubes-whonix:master:nrgaway:master
REPO_TRACK += qubes-whonix:master:whonix:master


#[==- 'Whonix' ==================================================================
#[==- defaults: [R2:9.6, R3:9.6, R3.1:master]
#[===============================================================================
#GIT_URL_Whonix = $(GITHUB_PREFIX)Whonix.git
#BRANCH_Whonix = $(word $(RELEASE_INDEX), 9.6 9.6 9.6)

REPO_TRACK += yamlscript-formula:master:origin:master
REPO_TRACK += users-yamlscript-formula:master:origin:master
REPO_TRACK += mgmt-salt:master:qubesos:master
REPO_TRACK += mgmt-salt-all-gnupg:master:origin:master
REPO_TRACK += mgmt-salt-all-privacy:master:origin:master
REPO_TRACK += mgmt-salt-all-salt:master:origin:master
REPO_TRACK += mgmt-salt-all-theme:master:origin:master
REPO_TRACK += mgmt-salt-all-vim:master:origin:master
REPO_TRACK += mgmt-salt-all-yamlscript-renderer:master:origin:master
REPO_TRACK += mgmt-salt-all-yamlscript-users:master:origin:master
REPO_TRACK += mgmt-salt-app-saltstack:master:origin:master
REPO_TRACK += mgmt-salt-base:master:qubesos:master
REPO_TRACK += mgmt-salt-base-config:master:qubesos:master
REPO_TRACK += mgmt-salt-base-overrides:master:qubesos:master
REPO_TRACK += mgmt-salt-base-topd:master:qubesos:master
REPO_TRACK += mgmt-salt-demo:master:origin:master
REPO_TRACK += mgmt-salt-dev:master:origin:master
REPO_TRACK += mgmt-salt-dom0-fix-permissions:master:origin:master
REPO_TRACK += mgmt-salt-dom0-policy-qubesbuilder:master:origin:master
REPO_TRACK += mgmt-salt-dom0-qvm:master:qubesos:master
REPO_TRACK += mgmt-salt-dom0-template-upgrade:master:origin:master
REPO_TRACK += mgmt-salt-dom0-update:master:qubesos:master
REPO_TRACK += mgmt-salt-dom0-virtual-machines:master:qubesos:master
REPO_TRACK += mgmt-salt-template:master:origin:master
REPO_TRACK += mgmt-salt-vm-python-pip:master:origin:master

BRANCH_yamlscript_formula = $(word $(RELEASE_INDEX), master master)
BRANCH_users_yamlscript_formula = $(word $(RELEASE_INDEX), master master)
BRANCH_mgmt_salt_app_saltstack = $(word $(RELEASE_INDEX), master develop)

BRANCH_mgmt_salt = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_all_gnupg = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_all_privacy = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_all_salt = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_all_theme = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_all_vim = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_all_yamlscript_renderer = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_all_yamlscript_users = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_base = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_base_config = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_base_overrides = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_base_topd = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_demo = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_dev = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_dom0_fix_permissions = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_dom0_policy_qubesbuilder = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_dom0_qvm = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_dom0_template_upgrade = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_dom0_update = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_dom0_virtual_machines = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_template = $(word $(RELEASE_INDEX), master staging)
BRANCH_mgmt_salt_vm_python_pip = $(word $(RELEASE_INDEX), master staging)

[==- 'template-whonix' =========================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_template_whonix = $(GITHUB_PREFIX)template-whonix.git
BRANCH_template_whonix = $(word $(RELEASE_INDEX), master master master)
REPO_TRACK += template-whonix:master:marmarek:master

[==- 'builder' =================================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_builder = $(GITHUB_PREFIX)builder.git
BRANCH_builder = $(word $(RELEASE_INDEX), nrgaway nrgaway nrgaway)
REPO_TRACK += ..:master:marmarek:master
REPO_TRACK += ..:nrgaway:marmarek:master


[==- 'builder-debian' ==========================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_builder_debian = $(GITHUB_PREFIX)builder-debian.git
BRANCH_builder_debian = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += builder-debian:master:marmarek:master


[==- 'builder-fedora' ==========================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_builder_fedora = $(GITHUB_PREFIX)builder-fedora.git
#BRANCH_builder_fedora = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += builder-fedora:master:marmarek:master


[==- 'builder-archlinux' =======================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_builder_archlinux = $(GITHUB_PREFIX)builder-archlinux.git
#BRANCH_builder_archlinux = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += builder-archlinux:master:marmarek:master


[==- 'antievilmaid' ============================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_antievilmaid = $(GITHUB_PREFIX)antievilmaid.git
#BRANCH_antievilmaid = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += antievilmaid:master:marmarek:master


[==- 'app-linux-img-converter' =================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_app_linux_img_converter = $(GITHUB_PREFIX)app-linux-img-converter.git
#BRANCH_app_linux_img_converter = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += app-linux-img-converter:master:marmarek:master


[==- 'app-linux-input-proxy' ===================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_app_linux_input_proxy = $(GITHUB_PREFIX)app-linux-input-proxy
#BRANCH_app_linux_input_proxy = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += app-linux-input-proxy:master:marmarek:master


[==- 'app-linux-pdf-converter' =================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_app_linux_pdf_converter = $(GITHUB_PREFIX)app-linux-pdf-converter.git
#BRANCH_app_linux_pdf_converter = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += app-linux-pdf-converter:master:marmarek:master


[==- 'app-linux-split-gpg' =====================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_app_linux_split_gpg = $(GITHUB_PREFIX)app-linux-split-gpg.git
#BRANCH_app_linux_split_gpg = $(word $(RELEASE_INDEX), templates master)
REPO_TRACK += app-linux-split-gpg:master:marmarek:master


[==- 'app-linux-tor' ===========================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_app_linux_tor = $(GITHUB_PREFIX)app-linux-tor.git
#BRANCH_app_linux_tor = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += app-linux-tor:master:marmarek:master


[==- 'app-thunderbird' =========================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_app_thunderbird = $(GITHUB_PREFIX)app-thunderbird.git
#BRANCH_app_thunderbird = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += app-thunderbird:master:marmarek:master


[==- 'artwork' =================================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_artwork = $(GITHUB_PREFIX)artwork.git
#BRANCH_artwork = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += artwork:master:marmarek:master


[==- 'core-admin' ==============================================================
[==- defaults: [R2:release2, R3:master, R3.1:master] ['core3']
[===============================================================================
#GIT_URL_core_admin = $(GITHUB_PREFIX)core-admin.git
###BRANCH_core_admin = $(word $(RELEASE_INDEX), release2 core3)
###REPO_TRACK += core-admin:core3:woju:core3
BRANCH_core_admin = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += core-admin:master:marmarek:master


[==- 'core-admin-linux' ========================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_core_admin_linux = $(GITHUB_PREFIX)core-admin-linux.git
#BRANCH_core_admin_linux = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += core-admin-linux:master:marmarek:master


[==- 'core-agent-linux' ========================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_core_agent_linux = $(GITHUB_PREFIX)core-agent-linux.git
BRANCH_core_agent_linux = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += core-agent-linux:master:marmarek:master


[==- 'core-libvirt' ============================================================
[==- defaults: [R2:n/a, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_core_libvirt = $(GITHUB_PREFIX)core-libvirt.git
#BRANCH_core_libvirt = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += core-libvirt:master:marmarek:master


[==- 'core-qubesdb' ============================================================
[==- defaults: [R2:n/a, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_core_qubesdb = $(GITHUB_PREFIX)core-qubesdb.git
#BRANCH_core_qubesdb = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += core-qubesdb:master:marmarek:master


[==- 'core-vchan-xen' ==========================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_core_vchan_xen = $(GITHUB_PREFIX)core-vchan-xen.git
#BRANCH_core_vchan_xen = $(word $(RELEASE_INDEX), r2-templates master)
REPO_TRACK += core-vchan-xen:master:marmarek:master


[==- 'desktop-linux-kde' =======================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_desktop_linux_kde = $(GITHUB_PREFIX)desktop-linux-kde.git
#BRANCH_desktop_linux_kde = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += desktop-linux-kde:master:marmarek:master


[==- 'desktop-linux-xfce4' =====================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_desktop_linux_xfce4 = $(GITHUB_PREFIX)desktop-linux-xfce4.git
#BRANCH_desktop_linux_xfce4 = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += desktop-linux-xfce4:master:marmarek:master


[==- 'gui-agent-linux'==========================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[==- git diff debian..upstream/release2
[==- '*** upstream still missing appvm-scripts/usrbin/qubes-session commit ***'
[===============================================================================
#GIT_URL_gui_agent_linux = $(GITHUB_PREFIX)gui-agent-linux.git
BRANCH_gui_agent_linux = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += gui-agent-linux:master:marmarek:master


[==- 'gui-agent-xen-hvm-stubdom' ===============================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_gui_agent_xen_hvm_stubdom = $(GITHUB_PREFIX)gui-agent-xen-hvm-stubdom.git
#BRANCH_gui_agent_xen_hvm_stubdom = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += gui-agent-xen-hvm-stubdom:master:marmarek:master


[==- 'gui-common' ==============================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_gui_common = $(GITHUB_PREFIX)gui-common.git
#BRANCH_gui_common = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += gui-common:master:marmarek:master


[==- 'gui-daemon' ==============================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_gui_daemon = $(GITHUB_PREFIX)gui-daemon.git
#BRANCH_gui_daemon = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += gui-daemon:master:marmarek:master


[==- 'installer-qubes-os' ======================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_installer_qubes_os = $(GITHUB_PREFIX)installer-qubes-os.git
#BRANCH_installer_qubes_os = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += installer-qubes-os:master:marmarek:master


[==- 'linux-template-builder' ==================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[==- branches: debian, ubuntu, fc21, whonix9.2, whonix9.4, whonix
[===============================================================================
#GIT_URL_linux_template_builder = $(GITHUB_PREFIX)linux-template-builder.git
BRANCH_linux_template_builder = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += linux-template-builder:master:marmarek:master


[==- 'linux-utils' =============================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_linux_utils = $(GITHUB_PREFIX)linux-utils.git
#BRANCH_linux_utils = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += linux-utils:master:marmarek:master


[==- 'linux-kernel' ============================================================
[==- defaults: [R2:stable-3.12, R3:stable-3.12, R3.1:master]
[===============================================================================
ifneq ($(TEMPLATE_ONLY), 1)
# Could just comment this out to receive from upstream
  #GIT_URL_linux_kernel = $(GITHUB_PREFIX)linux-kernel.git
  BRANCH_linux_kernel = stable-3.18
  REPO_TRACK += linux-kernel:stable-3.18:marmarek:stable-3.18
  
  COMPONENTS := $(patsubst linux-kernel, linux-kernel linux-kernel-3_12, $(COMPONENTS))
  GIT_URL_linux_kernel_3_12 = $(GITHUB_PREFIX)linux-kernel.git
  BRANCH_linux_kernel_3_12 = stable-3.12
  REPO_TRACK += linux-kernel-3_12:stable-3.12:marmarek:stable-3.12

  # Insert COMPONENT after linux-kernel
  #COMPONENTS := $(patsubst linux-kernel, linux-kernel linux-kernel-3_18, $(COMPONENTS))
  #GIT_URL_linux_kernel_3_18 = $(GITHUB_PREFIX)linux-kernel.git
  #BRANCH_linux_kernel_3_18 = stable-3.18
  #REPO_TRACK += linux-kernel-3_18:stable-3.18:marmarek:stable-3.18

  # Insert COMPONENT after linux-kernel
  #COMPONENTS := $(patsubst linux-kernel, linux-kernel linux-kernel-3_18, $(COMPONENTS))
  #GIT_URL_linux_kernel_3_18 = $(GITHUB_PREFIX)linux-kernel.git
  #BRANCH_linux_kernel_3_18 = devel-3.18
  #REPO_TRACK += linux-kernel-3_18:devel-3.18:marmarek:devel-3.18

  # Insert COMPONENT after linux-kernel
  COMPONENTS := $(patsubst linux-kernel, linux-kernel linux-kernel-3_19, $(COMPONENTS))
  GIT_URL_linux_kernel_3_19 = $(GITHUB_PREFIX)linux-kernel.git
  BRANCH_linux_kernel_3_19 = devel-3.19
  REPO_TRACK += linux-kernel-3_19:devel-3.19:marmarek:devel-3.19

  # Insert COMPONENT after linux-kernel
  #COMPONENTS := $(patsubst linux-kernel, linux-kernel linux-kernel-3_14, $(COMPONENTS))
  #GIT_URL_linux_kernel_3_14 = $(GITHUB_PREFIX)linux-kernel.git
  #BRANCH_linux_kernel_3_14 = devel-3.14+vgt

  # Insert COMPONENT after linux-kernel
  #COMPONENTS := $(patsubst linux-kernel, linux-kernel linux-kernel-3_18, $(COMPONENTS))
  #GIT_URL_linux_kernel_3_18 = $(GITHUB_PREFIX)linux-kernel.git
  #BRANCH_linux_kernel_3_18 = devel-3.18+vgt
endif


[==- 'linux-yum' ===============================================================
[==- defaults: [R2:master, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_linux_yum = $(GITHUB_PREFIX)linux-yum.git
#BRANCH_linux_yum = $(word $(RELEASE_INDEX), master master)
REPO_TRACK += linux-yum:master:marmarek:master


[==- 'manager' =================================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_manager = $(GITHUB_PREFIX)manager.git
#BRANCH_manager = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += manager:master:marmarek:master


[==- 'vmm-xen' =================================================================
[==- defaults: [R2:release2, R3:xen-4.4, R3.1:master]
[===============================================================================
#GIT_URL_vmm_xen = $(GITHUB_PREFIX)vmm-xen.git
#BRANCH_vmm_xen = $(word $(RELEASE_INDEX), r2-templates xen-4.6)
REPO_TRACK += vmm-xen:xen-4.6:marmarek:xen-4.6


[==- 'vmm-xen-windows-pvdrives' ================================================
[==- defaults: [R2:release2, R3:master, R3.1:master]
[===============================================================================
#GIT_URL_vmm_xen_windows_pvdrivers = $(GITHUB_PREFIX)vmm-xen-windows-pvdrivers.git
#BRANCH_vmm_xen_windows_pvdrivers = $(word $(RELEASE_INDEX), release2 master)
REPO_TRACK += vmm-xen-windows-pvdrivers:master:marmarek:master

[===============================================================================
[==-                     'C U S T O M   R U L E S'
[===============================================================================
# Set current branch for builder so it does not change to master
BRANCH_builder := $(shell git rev-parse --abbrev-ref HEAD)

[===============================================================================
[==-                   'C U S T O M   T A R G E T S'
[===============================================================================
.PHONY: repo-fetch repo-remotes repo-status repo-rebase repo-push repo-tracking
repo-fetch:
	@./repo fetch

repo-remotes:
	@./repo remotes --ignore

repo-status:
	@./repo --nofetch status --ignore

repo-rebase:
	@./repo --nofetch rebase --ignore

repo-push:
	@./repo --nofetch push --ignore

repo-tracking:
	@./repo --nofetch tracking

remote: repo-fetch repo-remotes repo-status
	@true

#.PHONY: template-modules
#template-modules:: COMPONENTS :=  $(TEMPLATE)
#template-modules:: umount patch build-info qubes-vm
#	@echo "Creating template modules..."
#
#qubes-vm:: COMPONENTS := $(TEMPLATE)
#qubes-vm:: 
#	@true

get-sources:: import-keys

# Verify marek key trust
verify-trust-marek: GPGKEY = 0064428F455451B3EBE78A7F063938BA42CFA724
verify-trust-marek:
	@gpg --list-keys --list-options show-uid-validity $(GPGKEY) | grep -q '\[ultimate\]' || {
	    echo '$(GPGKEY):6:' | gpg --import-ownertrust
	}

# Import nrgaway key to git keyring
import-key-nrgaway: GPGKEY = E0E32283FDCAC1A510078F271BB9B1FB5A4C6DAD
import-key-nrgaway:
	@gpg --list-keys $(GPGKEY) >/dev/null 2>&1 || {
	    gpg --import nrgaway-qubes-signing-key.asc
	    echo '$(GPGKEY):6:' | gpg --import-ownertrust
	}

# Calling verify-git-tag.sh will create keyrings dir and add developer keys
# if they have not been setup yet
verify-git-tag:
	@./scripts/verify-git-tag $(PWD) >/dev/null 2>&1 || true

verify-trust: verify-trust-marek
	@true

import-keys: GNUPGHOME = $(PWD)/keyrings/git
import-keys: verify-git-tag import-key-nrgaway verify-trust
	@gpg --list-keys
	@touch "$(GNUPGHOME)/pubring.gpg"

# Returns variable value
# Example usage: GET_VAR=DISTS_VM make get-var
.PHONY: get-vars
get-vars::
	@$(eval vars = $(subst :, ,$(GET_VARS)))
	@for var in $(vars); do \
	    echo $${!var}; \
	done

about::
	@echo "override.conf"

.PHONY: import-keys import-key-nrgaway verify-trust verify-trust-marek

